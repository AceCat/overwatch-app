var bodyParser = require('body-parser');
var Character = require('../models/Character');
var express = require('express');
var path = require('path');
var router = express.Router();


router.use(bodyParser.json());


//////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////
/////////////////////////////      GET REQUESTS        ///////////////////////
//////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////

router.get('/', function (request, response) {
Character.find(function(error, characters) {
      var allCharacters = characters
      response.send(allCharacters);
  })
});

router.get('/:name', function (request, response) {
	var charName = request.params.name
	Character.findOne({ name: charName}, function (err, character) {
		response.send(character)
	})
})

// router.get('/:id', function (request, response) {
// 	let id = request.params.id;
// 	Character.findById(id, function (err, character) {
// 		response.send(character)
// 	})
// });

//////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////
/////////////////////////////      POST REQUESTS        ///////////////////////
//////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////

router.post('/', function (request, response) {
	var character = new Character ({
		name: request.body.name,
		role: request.body.role,
		health: request.body.health,
		stats: request.body.stats, 
		description: request.body.description
	})
	console.log(request)
	character.save();
	response.send(character.stats);
});

//////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////
/////////////////////////////      PATCH REQUESTS        ///////////////////////
//////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////

router.patch('/:id', function (request, response) {
	let id = request.params.id;
	Character.findById(id, function(err, character) {
		console.log(err);
		character.name = request.body.name;
		character.role = request.body.role;
		character.health = request.body.health;
		character.image = request.body.image;
		character.stats = request.body.stats;
		character.description = request.body.description
		character.save();
		response.send(character)
	})
});

//////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////
/////////////////////////////      DELETE REQUESTS        ///////////////////////
//////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////

router.delete('/:id', function (request, response) {
	let id = request.params.id;
	Character.findById(id, function (err, character) {
		character.remove()
	})
	response.send('removed character')
});

module.exports = router;
